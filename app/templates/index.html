{% extends 'base.html' %}

{% block content %}

<!-- System Metrics -->
<p>CPU Temp: <span id="cpu-temp">{{ cpu_temp }}</span>Â°C</p>
<p>CPU Load: <span id="cpu-load">{{ cpu_load }}</span>%</p>
<p>RAM Usage: <span id="ram-used">{{ ram['used'] }}</span>/<span id="ram-total">{{ ram['total'] }}</span> MB (<span id="ram-percent">{{ ram['percent'] }}</span>%)</p>
<p>Throttle: <span id="throttle-status">{{ throttle }}</span></p>

{% if video_enabled %}
<div class="responsive-video">
    <!-- WebRTC stream -->
    <iframe
        id="video-iframe"
        src="http://{{ request.host.split(':')[0] }}:8889/{{ stream_path }}"
        allow="fullscreen; autoplay; camera; microphone"
        allowfullscreen
    ></iframe>
</div>
{% elif audio_enabled %}
    <!-- Audio-only icecast stream -->
    <iframe
        id="audio-iframe"
        src="http://{{ request.host.split(':')[0] }}:8889/{{ stream_path }}"
        allow="autoplay; microphone"
        allowfullscreen
    ></iframe>
{% else %}
    <div class="gif-container">
        <img src="{{ url_for('static', filename='images/confused_travolta.gif') }}" 
            width="490" 
            height="476">
    </div>

    <!-- Loudness display -->
    <!-- <div id="loudness-panel">
        <div>Level: <span id="loudness-db">{{ loudness_db if loudness_db is defined else 'N/A' }}</span> dB</div>
        <canvas id="loudness-chart" width="400" height="80"></canvas>
    </div> -->
{% endif %}

 

<!-- Sidebar toggle button -->
<button id="sidebar-toggle"><i class="fa-solid fa-bars"></i></button>

<!-- Desktop sidebar -->
<div id="sidebar">
    <!-- Video toggle -->
    <form action="/toggle_video" method="get">
        <button type="submit"><i class="fa-solid fa-video"></i> Video {{ 'ON' if video_enabled else 'OFF' }}</button>
    </form>

    <!-- Audio toggle -->
    <form action="/toggle_audio" method="get">
        <button type="submit"><i class="fa-solid fa-microphone"></i> Audio {{ 'ON' if audio_enabled else 'OFF' }}</button>
    </form>

    <!-- System buttons -->
    <a href="/shutdown" class="system-btn" onclick="return confirm('Really shutdown the Pi?')">
        <i class="fa-solid fa-power-off"></i> Shutdown
    </a>
    <a href="/reboot" class="system-btn" onclick="return confirm('Really reboot the Pi?')">
        <i class="fa-solid fa-rotate-right"></i> Reboot
    </a>
</div>

<!-- Mobile bottom bar -->
<div id="mobile-controls">
    <form action="/toggle_video" method="get">
        <button type="submit">
            <i class="fa-solid fa-video"></i>
            <span class="status-led {{ 'on' if video_enabled else 'off' }}"></span>
        </button>
    </form>
    <form action="/toggle_audio" method="get">
        <button type="submit">
            <i class="fa-solid fa-microphone"></i>
            <span class="status-led {{ 'on' if audio_enabled else 'off' }}"></span>
        </button>
    </form>
    <button class="control-btn" onclick="toggleControlSidebar()"><i class="fa-solid fa-gear"></i></button>
</div>

<!-- Mobile control sidebar -->
<div id="control-sidebar">
    <a href="/shutdown" onclick="return confirm('Really shutdown the Pi?')"><i class="fa-solid fa-power-off"></i> Shutdown</a>
    <a href="/reboot" onclick="return confirm('Really reboot the Pi?')"><i class="fa-solid fa-rotate-right"></i> Reboot</a>
</div>
<div id="control-sidebar-overlay" onclick="toggleControlSidebar()"></div>
{% endblock content %}